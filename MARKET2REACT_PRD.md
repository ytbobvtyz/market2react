# Product Requirements: Wishlist App (WB Parser)

## **Основной контекст**
- **Цель**: Многопользовательское приложение для отслеживания цен на Wildberries с опцией монетизации.
- **Порядок работы сервиса**: На основной странице пользователь вводит в основную поисковую  строку артикул WB, в соседнее поле "моя цена" вводит желаемую цену в рублях, а так же выбирает одну из двух опций "отслеживать только это предложение" или "отслеживать схожие товары других продавцов". Если выбран пункт "отслеживать предложения других продавцов", выводится шакала минимального рейтинга продавца и шкала минимального количества отзывов. При нажатии кнопки "проверить результат" внизу страницы появляется таблица с результатами всех продавцов, удовлетворяющих заданным критериям (название, артикул-гиперссылка на wb, цена, рейтинг). При нажатии кнопки "Сохранить мой запрос" запрос фиксируется в базе данных. Начинается ежедневный парсинг по параметрам запроса и сохранение результаов в БД.
- **Структура сайта**: Основная страница - окно формирования новых поисковых запросов. Лимиты - 2 запроса для отслеживания бесплатно, 20 - по подписке. Дополнительная страница - "все запросы" (от 1 до 20 на каждого пользователя), где пользователь выбирает запросы для просморта (слева) и просматривает график изменения цены (справа).

    ## 1. Основные требования  
### 1.1. Пользовательские сценарии  
1. Поиск товара:  
   - Пользователь вводит WB артикул.  
   - Если выбран пункт "отслеживать схожие товары других продавцов", Сервис через API WB выдает список аналогичных товаров с:  
     - Названием, ценой, рейтингом, ссылкой.  
     - Возможностью фильтрации (бренд, категория, цена).  
2. Сохранение запроса:  
   - После выбора товара пользователь указывает:  
     - Желаемую цену.  
     - При необходимости редактирует название запроса (например, "Айфон 15 в синем").  
   - Лимиты: 3 запроса бесплатно, 20 — по подписке.  
3. Отслеживание и уведомления:  
   - Ежедневная проверка цен через API WB.  
   - Уведомления в Telegram и Email при достижении целевой цены.  
4. Личный кабинет:  
   - Просмотр всех отслеживаемых товаров.  
   - История изменения цен (график).  
   - Ручной запуск проверки ("Проверить сейчас").  
   - Редактирование параметров (например, изменить желаемую цену).  

### 1.2. Монетизация  
- Бесплатно: 3 активных запроса.  
- Подписка (200 руб/мес):  
  - 20 запросов.  
  - Приоритетные уведомления (Telegram + Email).  

---

## 2. Техническая реализация  
### 2.1. Стек  
- Frontend: React (двухстраничный интерфейс, без сложного UX).  
- Backend: Python (FastAPI для API + Celery для задач).  
- База данных: PostgreSQL (SQLAlchemy для ORM).  
- Парсинг: Официальное API Wildberries + Selenium 
- Уведомления:  
  - Telegram: через Bot API.  
  - Email: SMTP (SendGrid/Mailgun).  
- Асинхронные задачи: Celery + Redis (расписание проверок).  

### 2.2. Схема базы данных  
sql  

TABLE users (  
  id UUID PRIMARY KEY,  
  email TEXT UNIQUE,  
  telegram_chat_id TEXT,  -- для уведомлений  
  subscription_tier TEXT  -- "free" или "pro"  
);  

TABLE trackings (  
  id UUID PRIMARY KEY,  
  user_id UUID REFERENCES users(id),  
  wb_item_id TEXT,       -- ID товара на WB  
  custom_name TEXT,      -- "Кроссовки Nike мечты"  
  desired_price DECIMAL,  
  min_rating FLOAT,
  min_comment INTEGER
  is_active BOOLEAN,  
  created_at TIMESTAMP  
);  

TABLE price_history (  
  id UUID PRIMARY KEY,  
  tracking_id UUID REFERENCES trackings(id),  
  price DECIMAL,  
  checked_at TIMESTAMP  
);  
  

### 2.3. API-интеграция с Wildberries  
- Используем официальное API WB для поиска товаров и получения актуальных цен.  
- При неудчае используем selenium
 # TODO: API WB на данный момент не работает, необходимо реализовать дублирующий код с помощью SELENIUM
  

### 2.4. Поток данных  
1. Пользователь ищет товар → React отправляет запрос в FastAPI.  
2. FastAPI дергает API WB → возвращает результаты в React.  
3. При сохранении запроса — данные пишутся в PostgreSQL.  
4. Каждую ночь Celery проверяет все активные запросы → обновляет price_history.  
5. Если цена упала → отправляет уведомление.  

---

## 3. Ограничения и риски  
- Лимиты API WB: возможны квоты на запросы → нужен retry-механизм.   

---

## 4. План разработки  
### Этап 1 (2 недели)  
- База данных + FastAPI (эндпоинты для поиска/сохранения).  
- Интеграция с API WB.  
- Прототип REACT (поиск + список отслеживаемого).  

### Этап 2 (1 неделя)  
- Celery-задачи для ежедневных проверок.  
- Уведомления в Telegram/Email.  

### Этап 3 (1 неделя)  
- Личный кабинет: графики цен, ручной запуск.  
- Настройка подписки.  

---

## 5. Метрики успеха  
- Количество активных пользователей: > 100 за первый месяц.  
- Конверсия в подписку: 5% от бесплатных пользователей.  
- Среднее количество запросов на пользователя: 2.5 (цель — мотивировать на апгрейд).  

## 6. Этапы разработки
[DONE] Разработать структуру проекта
[DONE] Разработать парсеры API и selenium
[DONE] Минимальная страница поиска с выводом результаов
[DONE] Пробросить вывод результатов парсинга из backend в frontend
[TODO] Frontend: Установить элементы дизайна страницы поиска - login/регистрация, переход на страницу отслеживания запросов, кнопка "Добавить в список отслеживания"
[TODO]Backend - реализовать форму регистрации и логина, добавить регистрацию/логин при попытке добавить в список отслеживания при отсутсвии запросов
[TODO]Backend - развернуть базу данных на внешнем сервере, продумать структуру таблиц и взаимосвязей.

